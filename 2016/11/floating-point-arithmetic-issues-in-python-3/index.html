<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Floating point arithmetic issues in Python 3</title>
  <meta property="og:title" content="Floating point arithmetic issues in Python 3" />
  <meta name="twitter:title" content="Floating point arithmetic issues in Python 3" />
  <meta name="description" content="By default, numbers having a decimal point are represented as floating point numbers.

Verification:

print(type(1.5))
#output
&lt;class &#39;float&#39;&gt;


Floating point numbers are represented in computer hardware in base 2. Floating point numbers are used to represent decimal (base 10) numbers in the most common use cases. But most decimal fractions cannot be represented exactly as binary fractions.

To understand this problem, consider the conversion of a decimal fraction to a decimal number: 1/3 is equal to 0.333... with repeating 3&rsquo;s. When represented as a decimal number, it will never be equal to 1/3.

Similarly, many decimal numbers cannot be represented accurately in base 2.

Some examples:

print(&quot;0.1 &#43; 0.2 = {}&quot;.format(0.1&#43;0.2))
#output
0.1 &#43; 0.2 = 0.30000000000000004

print(&quot;0.1 &#43; 0.4 = {}&quot;.format(0.1&#43;0.4))
#output
0.1 &#43; 0.4 = 0.5

print(&quot;1/10 = {}&quot;.format(1/10))
#output
1/10 = 0.1

print(&quot;Is (0.1 &#43; 0.1 &#43; 0.1 == 0.3) ?&quot;)
print(0.1 &#43; 0.1 &#43; 0.1 == 0.3)
#output
Is (0.1 &#43; 0.1 &#43; 0.1 == 0.3) ?
False


">
  <meta property="og:description" content="By default, numbers having a decimal point are represented as floating point numbers.

Verification:

print(type(1.5))
#output
&lt;class &#39;float&#39;&gt;


Floating point numbers are represented in computer hardware in base 2. Floating point numbers are used to represent decimal (base 10) numbers in the most common use cases. But most decimal fractions cannot be represented exactly as binary fractions.

To understand this problem, consider the conversion of a decimal fraction to a decimal number: 1/3 is equal to 0.333... with repeating 3&rsquo;s. When represented as a decimal number, it will never be equal to 1/3.

Similarly, many decimal numbers cannot be represented accurately in base 2.

Some examples:

print(&quot;0.1 &#43; 0.2 = {}&quot;.format(0.1&#43;0.2))
#output
0.1 &#43; 0.2 = 0.30000000000000004

print(&quot;0.1 &#43; 0.4 = {}&quot;.format(0.1&#43;0.4))
#output
0.1 &#43; 0.4 = 0.5

print(&quot;1/10 = {}&quot;.format(1/10))
#output
1/10 = 0.1

print(&quot;Is (0.1 &#43; 0.1 &#43; 0.1 == 0.3) ?&quot;)
print(0.1 &#43; 0.1 &#43; 0.1 == 0.3)
#output
Is (0.1 &#43; 0.1 &#43; 0.1 == 0.3) ?
False


">
  <meta name="twitter:description" content="By default, numbers having a decimal point are represented as floating point numbers.

Verification:

print(type(1.5))
#output
&lt;class &#39;float&#39;&gt;


Floating point numbers are represented in â€¦">
  <meta name="author" content="Plogging Dev"/>
  <meta property="og:image" content="https://www.ploggingdev.com/img/avatar.png" />
  <meta name="twitter:image" content="https://www.ploggingdev.com/img/avatar.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@ploggingdev" />
  <meta name="twitter:creator" content="@ploggingdev" />
  <meta property="og:url" content="https://www.ploggingdev.com/2016/11/floating-point-arithmetic-issues-in-python-3/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Plogging Dev" />

  <meta name="generator" content="Hugo 0.21" />
  <link rel="canonical" href="https://www.ploggingdev.com/2016/11/floating-point-arithmetic-issues-in-python-3/" />
  <link rel="alternate" href="https://www.ploggingdev.com/index.xml" type="application/rss+xml" title="Plogging Dev">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://www.ploggingdev.com/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://www.ploggingdev.com/css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://www.ploggingdev.com/css/highlight.min.css" />

<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-86436693-1 ', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">
<meta name="description" content="Floating point arithmetic issues in Python 3">

  
  <meta name="keywords" content="python 3, floats in python 3, floats not working python 3">
  
</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://www.ploggingdev.com/">Plogging Dev</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Archive" href="/archive/">Archive</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/about/">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Plogging Dev" href="https://www.ploggingdev.com/">
            <img class="avatar-img" src="https://www.ploggingdev.com/img/avatar.png" alt="Plogging Dev" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>Floating point arithmetic issues in Python 3</h1>
                
                
                  <span class="post-meta">
  Posted on November 27, 2016
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>By default, numbers having a decimal point are represented as floating point numbers.</p>

<p>Verification:</p>

<pre><code>print(type(1.5))
#output
&lt;class 'float'&gt;
</code></pre>

<p>Floating point numbers are represented in computer hardware in base 2. Floating point numbers are used to represent decimal (base 10) numbers in the most common use cases. But most decimal fractions cannot be represented exactly as binary fractions.</p>

<p>To understand this problem, consider the conversion of a decimal fraction to a decimal number: <code>1/3</code> is equal to <code>0.333...</code> with repeating 3&rsquo;s. When represented as a decimal number, it will never be equal to <code>1/3</code>.</p>

<p>Similarly, many decimal numbers cannot be represented accurately in base 2.</p>

<p>Some examples:</p>

<pre><code>print(&quot;0.1 + 0.2 = {}&quot;.format(0.1+0.2))
#output
0.1 + 0.2 = 0.30000000000000004

print(&quot;0.1 + 0.4 = {}&quot;.format(0.1+0.4))
#output
0.1 + 0.4 = 0.5

print(&quot;1/10 = {}&quot;.format(1/10))
#output
1/10 = 0.1

print(&quot;Is (0.1 + 0.1 + 0.1 == 0.3) ?&quot;)
print(0.1 + 0.1 + 0.1 == 0.3)
#output
Is (0.1 + 0.1 + 0.1 == 0.3) ?
False
</code></pre>

<p></p>

<p>In the above examples, notice that some decimal numbers can be represented accurately in base 2 while others cannot be represented accurately.</p>

<p>I won&rsquo;t pretend that I understand the intricate details behind why this happens, so I will link to some resources if you are interested to learn more: <a href="http://www.lahey.com/float.htm">The Perils of Floating Point</a> and <a href="http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">What Every Computer Scientist Should Know About Floating-Point Arithmetic</a>.</p>

<p>How can we overcome this issue in Python? Some solutions are:</p>

<ul>
<li>using <code>round()</code> function</li>
<li>using the <code>decimal</code> module</li>
<li>using the <code>fractions</code> module</li>
</ul>

<p>Let me explain each of these solutions a little more:</p>

<p>Using <code>round()</code>, floating point numbers can be rounded to a specified number of decimal places. If it&rsquo;s used for post rounding a result (round after performing all operations on floats), working with floats will work as expected. Example:</p>

<pre><code>print(&quot;Is (0.1 + 0.1 + 0.1 == 0.3) ?&quot;)
print(round(0.1 + 0.1 + 0.1, 5) == round(0.3, 5))
#output
Is (0.1 + 0.1 + 0.1 == 0.3) ?
True
</code></pre>

<p>The <code>round()</code> function accepts a number as the first parameter and another number to specify the precision after the decimal point as the second parameter. Example:</p>

<pre><code>print(round(10.33333, 3))
#output
10.333
</code></pre>

<p><strong>Edit:</strong> It has been pointed out to me that using <code>round()</code> may not be the best solution in certain cases where the rounded number will be used in calculations further in the program. Using <code>round()</code> in such cases will lead to accuracy issues. An option is to use string formatting to display the required number of digits since this will not round the numbers. Syntax is as follows:</p>

<pre><code>print('{: .3f}'.format(10.34123))
#output
10.341
</code></pre>

<p>Another alternative is to use the <code>decimal</code> module when dealing with decimal numbers and accuracy is very important. Example:</p>

<pre><code>from decimal import getcontext, Decimal
from math import pi

print(getcontext())

getcontext().prec = 5
print(Decimal(1)/Decimal(3))

getcontext().prec = 30
print(Decimal(pi))

#output
Context(prec=28, rounding=ROUND_HALF_EVEN, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[], traps=
[InvalidOperation, DivisionByZero, Overflow])
0.33333
3.141592653589793115997963468544185161590576171875
</code></pre>

<p><code>getcontext()</code> allows us to specify the precision and the rounding technique to be used, The default rounding technique is <code>ROUND_HALF_EVEN</code> which rounds to nearest with ties going to nearest even integer.</p>

<p>To deal directly with fractions, the <code>fractions</code> module can be used which supports rational number arithmetic. Example:</p>

<pre><code>from fractions import Fraction

num1 = Fraction(2,3)
num2 = Fraction(1,3)

print(&quot;num1 = {} and num2 = {}&quot;.format(num1,num2))

print(num1 + num2)

print(num1 - num2)

print(num1*10)

print(num1/num2)

#output
num1 = 2/3 and num2 = 1/3
1
1/3
20/3
2
&lt;class 'fractions.Fraction'&gt;
</code></pre>

<p>There are multiple ways to construct fractions and the details can be found in the official documentation which is linked below.</p>

<p>Source code for today&rsquo;s plog is <a href="https://github.com/ploggingdev/python_learn/blob/master/funny_floats.py">here</a>.</p>

<p>References:</p>

<ul>
<li><a href="https://docs.python.org/3/tutorial/floatingpoint.html">Official tutorial</a></li>
<li><a href="https://docs.python.org/3/library/functions.html#round">round() documentation</a></li>
<li><a href="https://docs.python.org/3/library/decimal.html#module-decimal">decimal module</a></li>
<li><a href="https://docs.python.org/3/library/fractions.html#module-fractions">fractions module</a></li>
<li><a href="http://www.lahey.com/float.htm">The Perils of Floating Point</a></li>
<li><a href="http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">What Every Computer Scientist Should Know About Floating-Point Arithmetic</a></li>
</ul>
      </article>

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="https://www.ploggingdev.com/2016/11/unit-testing-in-python-3/" data-toggle="tooltip" data-placement="top" title="Unit testing in Python 3">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="https://www.ploggingdev.com/2016/11/n-queens-solver-in-python-3/" data-toggle="tooltip" data-placement="top" title="N queens solver in Python 3">Next Post &rarr;</a>
          </li>
        
      </ul>

      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:ploggingdev@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/ploggingdev" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/ploggingdev" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
        </ul>
        <p class="credits copyright text-muted">
          Plogging Dev
          &nbsp;&bull;&nbsp;
          2017

          
            &nbsp;&bull;&nbsp;
            <a href="https://www.ploggingdev.com/">Plogging Dev</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.21</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://www.ploggingdev.com/js/main.js"></script>
<script src="https://www.ploggingdev.com/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>





  </body>
</html>

